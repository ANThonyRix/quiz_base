<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BASE BLUE SCAN</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        :root { --apple-blue: #0044ff; --apple-light-blue: #5599ff; --bg-color: #000a22; }
        body { background-color: var(--bg-color); color: var(--apple-light-blue); font-family: 'VT323', monospace; text-transform: uppercase; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        body::before { content: " "; display: block; position: fixed; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03)); z-index: 10; background-size: 100% 3px, 3px 100%; pointer-events: none; }
        .terminal { width: 100%; max-width: 850px; border: 3px solid var(--apple-blue); padding: 30px; box-shadow: 0 0 30px rgba(0, 68, 255, 0.3); background: rgba(0, 5, 15, 0.9); position: relative; z-index: 5; }
        .header { border-bottom: 2px solid var(--apple-blue); margin-bottom: 20px; padding-bottom: 10px; font-size: 1.2rem; }
        .gas-bar { display: flex; justify-content: space-between; font-size: 1.6rem; margin-bottom: 30px; }
        .input-area { display: flex; align-items: center; font-size: 1.6rem; border-bottom: 1px solid rgba(0, 68, 255, 0.3); padding-bottom: 5px; }
        input { background: transparent; border: none; color: var(--apple-light-blue); font-family: 'VT323', monospace; font-size: 1.6rem; outline: none; width: 100%; caret-color: transparent; }
        .cursor { display: inline-block; width: 14px; height: 24px; background: var(--apple-light-blue); animation: blink 0.8s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .results { margin-top: 20px; font-size: 1.4rem; line-height: 1.3; }
        .typing { margin-bottom: 6px; text-shadow: 0 0 5px var(--apple-blue); }
        .glow { text-shadow: 0 0 10px var(--apple-light-blue); }
    </style>
</head>
<body>
<div class="terminal">
    <div class="header glow">*** BASE BLUE SCAN ***</div>
    <div class="gas-bar">
        <div>ETH: $<span id="ethPrice">0000.00</span></div>
        <div>GAS: <span id="gasPrice">0.00000</span> GWEI</div>
    </div>
    <div class="input-area">
        <label class="glow">ADDR></label>
        <input type="text" id="walletAddr" spellcheck="false" autocomplete="off" autofocus placeholder="PASTE HERE">
        <span class="cursor"></span>
    </div>
    <div id="display" class="results">READY.</div>
</div>

<script>
    const API_KEY = '7RWV2ZFFQUXBSABTKJIADVDY3PCXFUQ9CW';
    const CHAIN_ID = '8453';
    let currentEthPrice = 0;
    let audioCtx;

    // Список токенов Base с контрактами
    const TOKEN_LIST = [
        { symbol: 'USDC',   address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', decimals: 6  },
        { symbol: 'WETH',   address: '0x4200000000000000000000000000000000000006', decimals: 18 },
        { symbol: 'DAI',    address: '0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb', decimals: 18 },
        { symbol: 'cbBTC',  address: '0xcbB7C0000aB88B473b1f5aFd9ef808440eed33Bf', decimals: 8  },
        { symbol: 'BRETT',  address: '0x532f27101965dd16442E59d40670FaF5eBB142E4', decimals: 18 },
        { symbol: 'TOSHI',  address: '0xAC1Bd2486aAf3B5C0fc3Fd868558b082a531B2B4', decimals: 18 },
        { symbol: 'DEGEN',  address: '0x4ed4E862860beD51a9570b96d89aF5E1B0Efefed', decimals: 18 },
        { symbol: 'cbETH',  address: '0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22', decimals: 18 },
    ];

    function initAudio() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playClick() {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.type = 'sine';
        osc.frequency.setValueAtTime(140, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 0.015);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.015);
        osc.start(); osc.stop(audioCtx.currentTime + 0.015);
    }

    async function typeWriter(text) {
        const display = document.getElementById('display');
        if (display.innerHTML === "READY.") display.innerHTML = "";
        const div = document.createElement('div');
        div.className = "typing";
        display.appendChild(div);
        for (let i = 0; i < text.length; i++) {
            div.innerHTML += text.charAt(i);
            playClick();
            await new Promise(r => setTimeout(r, 15));
        }
    }

    // ИСПРАВЛЕНО: цена ETH через Etherscan stats (без CoinGecko)
    async function loadStats() {
        try {
            const p = await fetch(
                `https://api.etherscan.io/v2/api?chainid=1&module=stats&action=ethprice&apikey=${API_KEY}`
            );
            const pData = await p.json();
            if (pData.result && pData.result.ethusd) {
                currentEthPrice = parseFloat(pData.result.ethusd);
                document.getElementById('ethPrice').innerText = currentEthPrice.toFixed(2);
            }

            const g = await fetch(
                `https://api.etherscan.io/v2/api?chainid=${CHAIN_ID}&module=proxy&action=eth_gasPrice&apikey=${API_KEY}`
            );
            const gData = await g.json();
            if (gData.result) {
                document.getElementById('gasPrice').innerText = (parseInt(gData.result, 16) / 1e9).toFixed(5);
            }
        } catch(e) { console.error("Stats update error", e); }
    }

    document.getElementById('walletAddr').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') { initAudio(); performSearch(); }
    });

    async function performSearch() {
        const addr = document.getElementById('walletAddr').value.trim();
        if (!addr.startsWith('0x') || addr.length < 42) {
            await typeWriter("> ERROR: INVALID ADDRESS");
            return;
        }

        document.getElementById('display').innerHTML = "";
        await typeWriter(`> CONNECTING TO BASE_NET...`);

        // --- 1. БАЛАНС ETH ---
        try {
            const bRes = await fetch(
                `https://api.etherscan.io/v2/api?chainid=${CHAIN_ID}&module=account&action=balance&address=${addr}&tag=latest&apikey=${API_KEY}`
            );
            const bData = await bRes.json();
            const rawBalance = bData.result && !isNaN(bData.result) ? bData.result : "0";
            const eth = parseFloat(rawBalance) / 1e18;
            const usd = (eth * (currentEthPrice || 0)).toFixed(2);
            await typeWriter(`> BALANCE: ${eth.toFixed(5)} ETH ($${usd})`);
        } catch (e) {
            await typeWriter(`> BALANCE: DATA ERROR`);
        }

        await new Promise(r => setTimeout(r, 300));

        // --- 2. ТОКЕНЫ ERC-20 (ИСПРАВЛЕНО: tokenbalance по контракту) ---
        try {
            await typeWriter(`> SCANNING ASSETS...`);
            let found = 0;
            for (let token of TOKEN_LIST) {
                const res = await fetch(
                    `https://api.etherscan.io/v2/api?chainid=${CHAIN_ID}&module=account&action=tokenbalance` +
                    `&contractaddress=${token.address}&address=${addr}&tag=latest&apikey=${API_KEY}`
                );
                const data = await res.json();
                if (data.status === "1" && data.result && data.result !== "0") {
                    const bal = parseFloat(data.result) / Math.pow(10, token.decimals);
                    if (bal > 0.0001) {
                        await typeWriter(`* TOKEN: ${bal.toFixed(4)} ${token.symbol}`);
                        found++;
                    }
                }
                await new Promise(r => setTimeout(r, 200)); // задержка между запросами
            }
            if (found === 0) await typeWriter(`> NO ERC-20 TOKENS FOUND.`);
        } catch (e) {
            await typeWriter(`> ASSET SCAN FAILED.`);
        }

        await new Promise(r => setTimeout(r, 300));

        // --- 3. NFT ---
        try {
            await typeWriter(`> SCANNING NFT COLLECTIONS...`);
            const nRes = await fetch(
                `https://api.etherscan.io/v2/api?chainid=${CHAIN_ID}&module=account&action=tokennfttx&address=${addr}&page=1&offset=15&sort=desc&apikey=${API_KEY}`
            );
            const nData = await nRes.json();
            if (nData.status === "1" && nData.result && nData.result.length > 0) {
                const seenNft = new Set();
                let nftCount = 0;
                for (let nft of nData.result) {
                    if (!seenNft.has(nft.contractAddress) && nftCount < 3) {
                        seenNft.add(nft.contractAddress);
                        await typeWriter(`* NFT: ${nft.tokenName || 'COLLECTION'} #${nft.tokenID.substring(0, 6)}`);
                        nftCount++;
                    }
                }
            } else {
                await typeWriter(`> NO NFT ASSETS DETECTED.`);
            }
        } catch (e) {
            await typeWriter(`> NFT SCAN ERROR.`);
        }

        await new Promise(r => setTimeout(r, 300));

        // --- 4. ИСТОРИЯ ТРАНЗАКЦИЙ ---
        try {
            await typeWriter(`> LOADING HISTORY...`);
            const txRes = await fetch(
                `https://api.etherscan.io/v2/api?chainid=${CHAIN_ID}&module=account&action=txlist&address=${addr}&page=1&offset=5&sort=desc&apikey=${API_KEY}`
            );
            const txData = await txRes.json();
            if (txData.status === "1" && txData.result && txData.result.length > 0) {
                for (let tx of txData.result) {
                    const type = tx.from.toLowerCase() === addr.toLowerCase() ? "OUT" : "IN";
                    const v = (parseFloat(tx.value) / 1e18).toFixed(4);
                    await typeWriter(`- TX [${type}] ${tx.hash.substring(0, 8)} VAL: ${v} ETH`);
                }
            } else {
                await typeWriter(`> NO RECENT TRANSACTIONS.`);
            }
        } catch (e) {
            await typeWriter(`> HISTORY LOADING ERROR.`);
        }

        await typeWriter(`> DONE. SYSTEM IDLE.`);
    }

    loadStats();
    setInterval(loadStats, 30000);
</script>
</body>
</html>
